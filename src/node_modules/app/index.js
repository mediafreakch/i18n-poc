// setup (factory)
var handlebars = require('hbsfy/runtime'),
    i18n = require('i18njs');

// register Handlebars View Helper.
handlebars.registerHelper('t', function(str, num, hashMap) {
    console.log(arguments);
    var variables = {},
        count,
        resolveHashMap = function(obj, hashMap) {
            for (var key in hashMap.hash) {
                obj[key] = hashMap.hash[key];
            }
        };

    if (typeof num === 'object' || hashMap ) {
        resolveHashMap(variables, num);
    }

    if (typeof num === 'number') {
        count = num;
    }

    if (hashMap) {
        resolveHashMap(variables, hashMap);
    };

    return (i18n ? i18n(str, count, variables /*, context, currently not supported */) : str);
});

// import translations
if (global.APP && global.APP.translations) {
    i18n.translator.add(global.APP.translations);
}

module.exports = {};
